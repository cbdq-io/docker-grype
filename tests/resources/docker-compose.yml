---
version: "3"

services:
  docker:
    container_name: docker
    environment:
      DOCKER_TLS_CERTDIR: ""
    image: docker:dind
    privileged: yes
    volumes:
      - certs:/certs/client
      - ../..:/work
    working_dir: /work

  grype:
    command: sleep infinity
    container_name: grype
    image: docker-grype:latest
    volumes:
      - .:/tmp

  sut:
    environment:
      ADD_CPES_IF_NONE: 0
      DOCKER_HOST: tcp://docker:2375
      DOCKER_TLS_CERTDIR: ""
      GRYPE_VERSION: "${GRYPE_VERSION}"
      IMAGE_NAME: docker-grype:latest
      LOG_LEVEL: DEBUG
      ONLY_FIXED: 1
      SHOW_ALL_VULNERABILITIES: 1
      VULNERABILITIES_ALLOWED_LIST: ''
    image: docker-grype:latest

  sutA:
    environment:
      ADD_CPES_IF_NONE: 0
      DOCKER_HOST: tcp://docker:2375
      DOCKER_TLS_CERTDIR: ""
      GRYPE_VERSION: "${GRYPE_VERSION}"
      IMAGE_NAME: docker-grype:latest
      LOG_LEVEL: DEBUG
      ONLY_FIXED: 1
      SHOW_ALL_VULNERABILITIES: 1
      VULNERABILITIES_ALLOWED_LIST: ''
    image: docker-grype:latest

  sutB:
    environment:
      ADD_CPES_IF_NONE: 1
      DOCKER_HOST: tcp://docker:2375
      DOCKER_TLS_CERTDIR: ""
      GRYPE_VERSION: "${GRYPE_VERSION}"
      IMAGE_NAME: docker-grype:latest
      LOG_LEVEL: DEBUG
      ONLY_FIXED: 1
      VULNERABILITIES_ALLOWED_LIST: ''
    image: docker-grype:latest

  sutC:
    environment:
      DOCKER_HOST: tcp://docker:2375
      DOCKER_TLS_CERTDIR: ""
      GRYPE_VERSION: "${GRYPE_VERSION}"
      IMAGE_NAME: docker-grype:latest
      LOG_LEVEL: DEBUG
      SHOW_ALL_VULNERABILITIES: 1
      VULNERABILITIES_ALLOWED_LIST: 'CVE-2015-20107,CVE-2015-5237,CVE-2020-10735,CVE-2019-8457,CVE-2020-16156,CVE-2021-22570,CVE-2021-29921,CVE-2021-33560,CVE-2021-3737,CVE-2022-0391,CVE-2022-1304,CVE-2022-2097,CVE-2022-29458'
    image: docker-grype:latest

  sutD:
    environment:
      ADD_CPES_IF_NONE: 1
      DOCKER_HOST: tcp://docker:2375
      DOCKER_TLS_CERTDIR: ""
      GRYPE_VERSION: "${GRYPE_VERSION}"
      IMAGE_NAME: docker-grype:latest
      LOG_LEVEL: DEBUG
      VULNERABILITIES_ALLOWED_LIST: 'CVE-2015-20107,CVE-2015-5237,CVE-2019-8457,CVE-2020-10735,CVE-2020-16156,CVE-2021-22570,CVE-2021-29921,CVE-2021-33560,CVE-2021-3737,CVE-2022-0391,CVE-2022-1304,CVE-2022-2097,CVE-2022-29458'
    image: docker-grype:latest

volumes:
  certs:
